<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test2</title>
    
</head>
<body>
    <h1>test</h1>
    <script>
        var queryString = window.location.search;
        document.write(queryString);
        document.write('\n');
        queryString = queryString.slice(1);
        document.write(queryString);
        document.write('\n');
        var parameters = queryString.split('&');
        document.write(parameters[0]);
        document.write(parameters[1]);
        document.write(parameters.length);
        document.write('\n');

        var queryObject = {};
        for (var i = 0; i < parameters.length; i++) {
            var element = parameters[i].split('=');

            var paramName = decodeURIComponent(element[0]);
            var paramValue = decodeURIComponent(element[1]);

            queryObject[paramName] = paramValue;
        }

        //verifir_id_token(queryObject['idToken']);

        verifir_access_token(queryObject['accessToken']);


        function verifir_id_token(idToken){
            const xhr = new XMLHttpRequest();
            xhr.open("POST", "https://api.line.me/oauth2/v2.1/verify", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.onload = function () {
                var data = this.response;
                //document.write(data);
                const obj = JSON.parse(data);
                document.write(obj['sub']);
            };
            xhr.send("id_token=" + idToken + "&client_id=2002036154");
        }

        function verifir_access_token(accessToken){
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "https://api.line.me/oauth2/v2.1/verify?access_token=" + accessToken, true);
            xhr.send();
            xhr.responseType = "json";
            xhr.onload = function () {
                var statusCode = this.status;
                document.write(statusCode);
                if (this.status == 200){

                    const xhr2 = new XMLHttpRequest();
                    xhr2.open("GET", "https://api.line.me/v2/profile", true);
                    xhr2.setRequestHeader('Authorization', 'Bearer{' + accessToken + '}');
                    xhr2.send();
                    xhr.responseType = "json";
                    xhr2.onload = function () {
                        var data = this.response;
                        document.write(data);
                    }
                }else{
                    document.write("failed");
                }
                // var data = this.response;
                // document.write(data);
                // const obj = JSON.parse(data);
                //document.write(obj['sub']);
            };
            
        }

    </script>
</body>
</html>