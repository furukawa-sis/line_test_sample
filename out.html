<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test2</title>
    
</head>
<body>
    <h1>test</h1>
    <script>
        var queryString = window.location.search;
        document.write(queryString);
        document.write('\n');
        queryString = queryString.slice(1);
        document.write(queryString);
        document.write('\n');
        var parameters = queryString.split('&');
        document.write(parameters[0]);
        document.write(parameters[1]);
        document.write(parameters.length);
        document.write('\n');

        var queryObject = {};
        for (var i = 0; i < parameters.length; i++) {
            var element = parameters[i].split('=');

            var paramName = decodeURIComponent(element[0]);
            document.write(paramName);
            document.write('\n');
            var paramValue = decodeURIComponent(element[1]);
            document.write(paramValue);
            document.write('\n');

            queryObject[paramName] = paramValue;
            document.write('\n');
        }
        document.write(queryObject['idToken']);

        verifir_id_token(queryObject['idToken']);


        function verifir_id_token(idToken){
            const xhr = new XMLHttpRequest();
            xhr.open("POST", "https://api.line.me/oauth2/v2.1/verify", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            //const body = 'id_token=' + idtoken + '&client_id=2002036154';
            const body = JSON.stringify({
                id_token: idToken,
                client_id: "2002036154",
            });
            xhr.onload = function () {
                var data = this.response;
                document.write(data);
                document.write(data['sub']);
                // if (xhr.readyState == 4 && xhr.status == 201) {
                //     console.log(JSON.parse(xhr.responseText));
                // } else {
                //     console.log(`Error: ${xhr.status}`);
                // }
            };
            xhr.send("id_token=" + idToken + "&client_id=2002036154");
        }

    </script>
</body>
</html>